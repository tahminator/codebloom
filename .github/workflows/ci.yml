name: Run Tests
run-name: Running tests on ${{ github.actor }}'s commits


on:
    push:
        branches:
            - main
    pull_request:

jobs:
    frontend-tests:
        name: Frontend Tests
        runs-on: ubuntu-latest
        steps:
          - name: Checkout Repository
            uses: actions/checkout@v4
    
          - name: Set up Node.js
            uses: actions/setup-node@v4
            with:
              node-version: 20

          - name: Fix a bug with corepack by installing corepack globally
            run: npm i -g corepack@latest
            working-directory: js

          - name: Install Dependencies
            run: corepack enable pnpm && pnpm i --frozen-lockfile
            working-directory: js

          - name: Run full suite of tests + linters + autoformatters
            run: pnpm run test
            working-directory: js
    
    backend-tests:
        name: Backend Tests
        runs-on: ubuntu-latest
        needs: frontend-tests
        steps:
            - name: Checkout Repository
              uses: actions/checkout@v4

            - name: Set up OpenJDK 21
              run: sudo apt-get update && sudo apt-get install -y openjdk-21-jdk

            - name: Cache Maven Dependencies
              uses: actions/cache@v3
              with:
                path: ~/.m2
                key: maven-${{ runner.os }}-${{ hashFiles('**/pom.xml') }}
                restore-keys: maven-${{ runner.os }}-
    
            - name: Run Checkstyle
              run: ./mvnw checkstyle:check
            
            - name: Run Tests
              run: ./mvnw test
    
